<link rel="stylesheet" href="/static/css/ol.css" type="text/css">
<link rel="stylesheet" href="/static/vendor/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />

<script src="/static/js/ol.js" type="text/javascript"></script>
<script src="/static/js/vendor/jquery.serializeJSON.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js"></script>
<!-- script src="http://maps.google.com/maps/api/js?sensor=false"></script -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js" type="text/javascript"></script>
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.8.1/jquery-ui.min.js" type="text/javascript"></script>

<style type="text/css">
    .ui-autocomplete {
    background-color: white;
    width: 300px;
    border: 1px solid #cfcfcf;
    list-style-type: none;
    padding-left: 0px;
    }
    label {
        font-size:16px;
    }
    #map_canvas label {
        width: auto;
        display: inline;
    }
    #map_canvas img {
        max-width: none;
    }
    .affix {
        width: inherit;
        height: 0px;
    }
  
    .affix-bottom {
        top: auto !important;
        position: fixed;
        bottom: 240px;
    }
    
    #imgContainer {
        height: 390px;
        width: 600px;
    } 
#map {
height:400px;
width:100%;
}
</style>

<div style="display:none;margin-top:15px; height:500px;" id="oldbrowser" class="row">
    <!-- Success and Error Messages for the user -->
    <div  class="col-md-8 col-md-offset-1 alert alert-info">
        <h2>
            Πρόβλημα του περιηγητή!
        </h2>
        <p>
            Συγγνώμη, αλλά ο περιηγητής σας δεν υποστηρίζει την τρέχουσα εφαρμογή. 
            Αν θέλετε να συμμετάσχετε, παρακαλώ πραγματοποιήστε αναβάθμιση σε μια σύγχρονη εκδοσή περιηγητή ιστού, 
            όπως οι ελεύθερες και δωρεάν λύσεις 
            <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> ή 
            <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a>.
        </p>
    </div>
</div> 
<!-- End of Row -->

<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Μπράβο!</strong> Το έργο σας έχει υποβληθεί με επιτυχία. Αν θέλετε, μπορείτε να συνεχίσετε με ένα ακόμη πατώντας εδώ!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Φόρτωση επόμενου έργου...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>Το έργο έχει ολοκληρωθεί.</strong> Ευχαριστώ πολύ!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>
            Συγχαρητήρια!
        </h2> 
        <p>
            Έχετε συμμετάσχει σε <strong>όλα</strong> τα διαθέσιμα έργα! Σας ευχαριστούμε για το ενδιαφέρον και τη βοήθειά σας.
        </p>
        <br/>
        <img src="https://crowdfunded.micropasts.org/assets/logo-head.png" width="200" height="200"/>
        <div class="alert-actions">
            <a class="btn-default btn" href="/">Πηγαίνετε πίσω ή</a>
            <a class="btn-default btn" href="/app">Ελέγξτε άλλες εφαρμογές</a>
        </div>
    </div>

    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">X.</a>
        <strong>Σφάλμα!</strong> Κάτι πήγε στραβά, παρακαλούμε επικοινωνήστε με τους διαχειριστές 
        του δικτυακού τόπου μέσω του φόρουμ, του Twitter, της σελίδας μας στο Facebook ή στέλνοντας email.
    </div>
</div> <!-- End Success and Error Messages for the user -->


<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->

<!-- Start Skeleton Row-->
<div class="row skeleton"> 

        <h1 id="start">
            Παρακαλώ μπορείτε να μεταγράψετε αυτό το απόσπασμα ενοριακού μητρώου στα Ελληνικά (και προαιρετικά να το μεταφράσετε και στα Αγγλικά)
        </h1> 
    
    <!-- The question will be loaded here -->
    
    <span class="label label-info">Σημείωση:</span>Μπορείτε να χρησιμοποιήσετε τον τροχό του ποντικιού σας ή την επιφάνεια αφής του φορητού σας υπολογιστή για μεγέθυνση/σμίκρυνση της εικόνας, καθώς και τη λειτουργία μεταφοράς και απόθεσης για να περιηγηθείτε στο έγγραφο

</div>

<!-- Start of Question and Submission DIV (column) -->
<div class="row skeleton">

    <div id="questions" class="col-md-4">
        <!-- If the user clicks this button, the saved answer will be value="yes"-->
        <form id="trans" role="form">        
            <!-- Transcription --> 
            <div class="form-group">
                <label class="control-label" for="transcription">Μεταγραφή στα Ελληνικά</label>
                <textarea class="form-control" rows="10" name="transcription" placeholder="Μεταγραφή στα Ελληνικά."></textarea>
            </div>
            <!-- Translation --> 
            <div class="form-group">
                <label class="control-label" for="translation">Προαιρετική μετάφραση στα Αγγλικά</label>
                <textarea class="form-control" rows="10" name="translation" placeholder="Προαιρετική μετάφραση στα Αγγλικά."></textarea>
            </div>
            <!-- Transcriber's comments --> 
            <div class="form-group">
                <label class="control-label" for="other">Σχόλια του συντελεστή</label>
                <textarea class="form-control" rows="5" name="other" placeholder="Σχόλια του συντελεστή."></textarea>
            </div>    
        </form>
        <button class="btn btn-info btn-answer" value='Yes'>Υποβολή έργου</button>
            
        <!-- Feedback items for the user -->
        <p>Εκτελείτε το έργο: <span id="task-id" class="label label-warning">#</span></p>
        <p>
        Έχετε συμπληρώσει: <span id="done" class="label label-info"></span> έργα από 
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
        </div>
    <!-- End of feedback row -->

    </div>
    <!-- End of Question and Submission DIV (column) -->
        <div class="row">
        <div class="btn-group">
            <button class="btn btn-info btn-xs" data-toggle="modal" data-target="#myModal"><i
                    class="glyphicon glyphicon-eye-open"></i> Σεμινάριο</button>
            <a class="btn btn-info btn-xs" id="imgLink" target="_blank" data-toggle="tooltip" data-placement="top"
               title="Opens in a new window" href="http://community.micropasts.org/category/crowdsourcing-support"><i
                    class="glyphicon glyphicon-book"></i> Community Help </a>
        </div>
        <!-- The column holding the open layers div -->    
    <div id="photo-link" class="col-md-7 col-md-offset-1">
        <!-- Start of Photo DIV (column) -->
        <div id="imgHolder" data-spy="affix" data-offset-top="1" data-offset-bottom="500">
            <!-- The container for the zoomer --> 
            <div id="imgContainer"></div>
            <div id="taskImg"></div>
        </div><!-- End of Photo DIV (columnt) -->
    </div>
</div><!-- End of Skeleton Row -->

<!-- Modal start -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
    <!-- Modal header --> 
           <div class="modal-header">
                <h3 class="lead">Σεμινάριο: Mεταγραφή Ιστορικών Ελληνικών Μητρώών Ενοριών <br>Tutorial: Transcribing a Greek parish church register</h3>
            </div>
            <div id="0" class="modal-body" style="display:none">
                <p>
                Η εφαρμογή αυτή έχει ως πρωταρχικό της στόχο τη μεταγραφή ενός μητρώου του 19ου αιώνα από το αυθεντικό χειρόγραφο μιας ενορίας. 
                Το μεγαλύτερο μέρος του μητρώου είναι στην ελληνική γλώσσα αλλά η χρήση συντομογραφιών και ιδιώματος το καθιστούν ιδιαίτερα δυσνόητο (Καθαρεύουσα).
                This application has the primary objective of transcribing a 19th century handwritten Greek register from a parish church transcription. 
                Most of the transcription is in Greek and is challenging because of its use of abbreviations and old-fashioned idiom (Katharevousa).  
                </p>
                <p>
                Θεωρούμε οτι το κείμενο δεν μπορεί να αποκρυπτογραφηθεί από την πλειοψηφία των σύγχρονων Ελλήνων ομιλητών, αλλά ελπίζουμε 
                ότι υπάρχουν κάποιοι που μπορούν! Η αντιγραφή γίνεται ακόμα πιο δύσκολη  λόγω της περιστασιακής παρουσίας λέξεων στα Ιταλικά 
                και τα Αγγλικά που θα θέλαμε, επίσης, να μεταγραφούν, όπου αυτό είναι δυνατό.
                It is not necessarily a text that most modern Greek speakers will find easy to decipher, but we are hoping that there are some who can! 
                The task is made more difficult still by the occasional presence of bits of text written in Italian and English 
                which we would also like to transcribe where possible (but you can leave these out if you prefer).
            </p>
                <p> 
                Finally, the contributor is invited to add an approximate English translation of the transcribed text if they wish (although this is not compulsory).
                Τέλος, οι συνεισφέροντες καλούνται να προσθέσουν και μια κατά προσέγγιση αγγλική μετάφραση του κειμένου, εφόσον βέβαια αυτοί το επιθυμούν (και αυτό, επίσης, δεν είναι υποχρεωτικό).
                </p>
                <p> 
                Η πλατφόρμα θα παρουσιάσει μια σαρωμένη σελίδα, απευθείας προερχόμενη από τη δημόσια διαδικτυακή πηγή ελληνικών αρχείων των 
                Γενικών Αρχείων του Κράτους (θα δείτε το υδατογράφημα των Γ.Α.Κ. στη σελίδα προς μεταγραφή). 
                Οι όροι χρήσης της σάρωσης ακολουθούν τους όρους χρήσης όλων των σαρώσεων των Γ.Α.Κ.
                The platform will present a scanned page loaded directly from the digital repository of the Greek State Archives 
                (you will notice the watermark of the latter stamped into the page and all terms and conditions for use of this scan 
                follow those of the Greek State Archives).
                </p>
                <p>
            	Μόλις φορτωθεί η εικόνα, θα σας ζητηθεί να μεταγράψετε (και προαιρετικά να μεταφράσετε) το περιεχόμενο της κάθε σελίδας. 
            	Ένα παράδειγμα τμήματος σελίδας του μητρώου παρέχεται παρακάτω:
            	Once the image has been loaded, you will be asked to transcribe (and optionally translate) the contents of each page. 
            	An example portion of a register page is provided below:
                </p>
                <img src="http://micropasts.org/wp-content/uploads/2015/01/BMD_Sample_Tutorial.png" class="img-polaroid" alt="An example of one of the Greek parish church registers" width="75%" height="75%"/>
            </div>
            <div id="1" class="modal-body" style="display:none">
                <p>
                Μερικά επιπλέον καθοδηγητικά σημεία καθώς κάνετε τη μεταγραφή:
                <br>Some further bits of guidance as you transcribe:
                <ul>    
                    <li>Παρακαλούμε να μεταγράψετε το κείμενο όσο το δυνατόν ακριβέστερα, ακολουθώντας το πρωτότυπο στη χρήση κεφαλαίων και μικρών, στη διαδοχή των σειρών καθώς και στα σημεία στίξης. 
                    	<br>Please transcribe the text as accurately as possible, following the original letter/word case, lines and punctuation.</li> 
                    <li>Προσπαθήστε να εισάγετε όλο το κείμενο που βλέπετε , με τη σωστή σειρά.
                    	<br>Try to enter all the text that you see, in the right order.</li>
                    <li>Αν χρειαστεί να παραλείψετε κομμάτια του κείμενου, λόγω δυσκολίας, χρησιμοποιήστε το σύμβολο [ ... ] 
                    	συμπεριλαμβανομένων και των αγκύλων, για να σηματοδοτηθεί η παράλειψη . Αν παραλείψετε περισσότερες από μία γραμμές, 
                    	επαναλάβετε αυτό το σύμβολο ανά γραμμή. 
                    	<br>If you need to skip text because it is not recogniseable, use the symbol [...] including the square brackets, 
                    	to signal this omission. If you skip more than one line, repeat this symbol per line.</li>     
                    <li>Αν θέλετε να μας μεταφέρετε παρατηρήσεις στη μέση του κειμένου παρακαλείστε να τις τοποθετήσετε σε αγκύλες . Για παράδειγμα , αν δυσκολεύεστε στην αποκρυπτογράφηση μιας 
                    	λέξης αλλά έχετε κάποια εκτίμηση να παραθέσετε, παρακαλούμε να τη συμπεριλάβετε γράφοντας [ αβέβαιο , εναλλακτικά: « Ποταμού » ]. 
                    	<br>If you want to pass any comments on to us, in the middle of the text, place them in square brackets. For example, 
                    	if a word is hard to decipher, do your best to identify it and then you might put [uncertain, alternative: 'Ποταμού']</li>
                    <li>Η εφαρμογή δέχεται τονισμένους ελληνικούς χαρακτήρες (UTF-8, συμπεριλαμβανωμένου και του πολυφωνικού συστήματος), οπότε παρακαλούμε να τους μεταγράψετε όπως τους βλέπετε.
                    	<br>The application accepts accented Greek characters (UTF-8, including polytonic), so feel free to use these.</li>
                </ul>            
                </p> 
            </div>
            <div id="2" class="modal-body" style="display:none">
                <p>
                Το πλαίσιο για την προσθήκη Αγγλικής μετάφρασης είναι εντελώς προαιρετικό, καθώς προτεραιότητά μας είναι η παραγωγή μιας καλής μεταγραφής στα Ελληνικά . Ωστόσο , εάν είστε σε θέση να προσφέρετε μια κατά προσέγγιση μετάφραση στα αγγλικά, τότε παρακαλούμε να λάβετε υπόψη τα ακόλουθα σημεία:
                <br>The box for adding an English translation is wholly optional because our priority is on producing a good Greek transcription. However, if you are able to offer an approximate English translation, then please bear in mind the following points:
                <ul>    
                    <li>Η δομή της μετάφρασης θα πρέπει να ακολουθεί εκείνη της μεταγραφής, ακόμα και προσεγγιστικά, οπότε παρακαλείστε να χρησιμοποιείτε τα ίδια σύμβολα για να επισημάνετε πιθανές παραλείψεις. 
                    	<br>The structure of the translation should roughly follow that of the transcription, so use the same symbols to indicate omissions. </li>
                    <li>Όπως και στη μεταγραφή, εάν δυσκολεύεστε στην αποκρυπτογράφηση μιας λέξης αλλά έχετε κάνει προσπάθεια προσέγγισής της, παρακαλούμε να παραθέσετε 
                    	μια σημείωση για να μας επισημάνετε το πρόβλημα. 
                    	<br>As with the transcription, if a word is hard to decipher, do your best to identify it and make a comment to note the problem.</li>    
                </ul>            
                </p>
            	<p>
                Καθ' όλη τη διάρκεια της μεταγραφής και της μετάφρασης,  μπορείτε να επιστρέψετε σε αυτό το σεμινάριο μέσω του κουμπιού "
                <br>During the transcription and translation, you can always return to this tutorial via the "Tutorial" button.
                </p>
                <p>
                Για να μάθετε πώς προχωράει το πρόγραμμα, να προτείνετε αλλαγές ως προς αυτή την εφαρμογή ή για νέες ερευνητικές ιδέες 
                με βάση αυτά που έχετε αντιγράψει και μεταφράσει , παρακαλούμε να ρίξετε μια ματιά στον ιστότοπό 
                μας <a href="http://community.micropasts.org" title="Community forum">http://community.micropasts.org</a>.
                <br>To find out how the project is progressing, suggest changes to this application or
                propose new research ideas based what you have transcribed and translated, please have a look at our <a href="http://community.micropasts.org" title="Community forum">community forum</a>.
                </p>
            </div>
        <!-- End of stepped modal body -->

        <!-- Modal footer -->
            <div class="modal-footer">
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <button id="startContrib" data-dismiss="modal" class="btn btn-primary" style="display:none"><i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
            </div>
    </div>
  </div>
</div>
<!-- Modal end --> 

<script>
var step = -1;
function showStep(action) {
    $("#" + step).hide();
    if (action == 'next') {
        step = step + 1;
    }
    if (action == 'prev') {
        step = step - 1;
    }
    if (step == 0) {
        $("#prevBtn").hide();
    }
    else {
        $("#prevBtn").show();
    }
    if (step == 2) {
        $("#nextBtn").hide();
        $("#startContrib").show();
    }
    $("#" + step).show();
}

showStep('next');
$("#modal").modal('show');
</script>

<!-- The modernizer script --> 
<script>
// Quick fix for IE8
Modernizr.load({
    test: window.JSON,
    nope: '/static/js/vendor/json2.min.js'
});
</script>

<!-- The main pybossa functions --> 
<script>
function loadUserProgress() {
    pybossa.userProgress('GreekBMD1').done(function(data){
        console.log(data);
        console.log("Total answers done for user: " + data.done);
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({'placement': 'left'});
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}
</script>

<script>
pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        var img = $('<img />');
        var div_map = $('<div/>');
        
        div_map.css("height", "390px");
        div_map.css("width", "600px");
        div_map.css("background", "#000");

        var copyright = "&copy; <a href='" + task.info.link + "'>Γενικά Αρχεία του Κράτους (Γ.Α.Κ.) 2015</a>";

        var extent = new OpenLayers.Bounds();
        extent.extend(new OpenLayers.LonLat(1.758939,58.672231).transform(new OpenLayers.Projection("EPSG:4326"),
        new OpenLayers.Projection('EPSG:900913')));
        
        extent.extend(new OpenLayers.LonLat(-6.99745,49.96112).transform(new OpenLayers.Projection("EPSG:4326"),
        new OpenLayers.Projection('EPSG:900913')));

        $("#imgContainer").append(div_map);
        div_map.attr("id", "img_" + task.id);

        task.pixelProjection = new ol.proj.Projection({
          code: 'pixel',
          units: 'pixels',
          extent: [0, 0, 1021, 1560]
        });

        task.map_img = new ol.Map({
            //interactions: ol.interaction.defaults().extend([task.select, task.modify]),
            layers: [
            new ol.layer.Image({
              source: new ol.source.ImageStatic({
                attributions: [
                  new ol.Attribution({
                    html: copyright
                  })
                ],
                url: task.info.url_b,
                imageSize: [1021, 1560],
                projection: task.pixelProjection,
                imageExtent: task.pixelProjection.getExtent()
              })
            })
          ],
          renderer: 'canvas',
          target: 'img_' + task.id,
          view: new ol.View({
            projection: task.pixelProjection,
            center: ol.extent.getCenter(task.pixelProjection.getExtent()),
            zoom: 1.0
          })
        });
        div_map.css("display", "none");

        // load image from flickr
        var img = $('<img />');
        img.attr("id", "img_task_" + task.id);
        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        img.attr('src', task.info.url_b);
        img.attr('width', '600px');
        img.attr('height', '390px');
        img.addClass('img-polaroid');
        img.css("cursor", "zoom-in");
        task.info.image = img;

    }  else {
        deferred.resolve(task);
    }
});
</script>

<script>
pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        loadUserProgress();
        $(':input','#trans')
           .not(':button, :submit, :reset, :hidden, :radio')
           .val('')
           .removeAttr('checked')
           .removeAttr('selected');
      
      	$("a#raw").attr("href", task.info.url_b);
	$("a#flickr").attr("href", task.info.link + '/sizes/k/');
	$("a#down").attr("download", task.id);
	$("a#down").attr("href", task.info.url_b );
        $(".fancybox").fancybox();
        $("[rel=tooltip]").tooltip();
        $("#question").html(task.info.question);
        $('#task-id').html(task.id);
        $("#img_" + task.id).show();

        $('.btn-answer').off('click').on('click', function(evt) {
            evt.preventDefault();
            var answer = $(evt.target).attr("value");
            if (typeof answer !== 'undefined') {
                console.log(answer);
                if (answer === 'search') {
                    $("#searching").show();
                    search(task, $("#toSearch").val(), 15);
                } else {
                    task.answer = $("#trans").serializeJSON();
                    console.log(task.answer);
                    pybossa.saveTask(task.id, task.answer).done(function() {
                        $("#img_" + task.id).hide();
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        $("#success").fadeIn(500).fadeOut(5500);
                        $("#loading").fadeIn(500).fadeOut(1000);
                        deferred.resolve();
                    });
                    $("#loading").fadeIn(500);
                    
                }
            } else {
                console.log(answer);
                console.log(typeof(answer));
                $("#error").show();
            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

if(Modernizr.borderradius) {
    pybossa.run('GreekBMD1');
}
else {
    $(".skeleton").hide();
    $("#oldbrowser").show();
}

$(window).off('.affix');
$("#imgHolder")
    .removeClass("affix affix-top affix-bottom")
    .removeData("bs.affix");
</script>
